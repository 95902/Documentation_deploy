import{_ as s,o as e,c as a,O as n}from"./chunks/framework.1bc11817.js";const D=JSON.parse(`{"title":"Initialisation d'un rôle Ansible","description":"","frontmatter":{},"headers":[],"relativePath":"initialisation_role.md","filePath":"initialisation_role.md"}`),l={name:"initialisation_role.md"},o=n(`<h1 id="initialisation-d-un-role-ansible" tabindex="-1">Initialisation d&#39;un rôle Ansible <a class="header-anchor" href="#initialisation-d-un-role-ansible" aria-label="Permalink to &quot;Initialisation d&#39;un rôle Ansible&quot;">​</a></h1><p>Voici une procédure détaillée pour l&#39;initialisation d&#39;un rôle Ansible avec les différentes tâches, templates et fichiers requis :</p><ol><li><p>Ouvrez un terminal ou une invite de commandes.</p></li><li><p>Utilisez la commande suivante pour initialiser un nouveau rôle Ansible en spécifiant le nom du rôle et le chemin où vous souhaitez créer le rôle :</p><p>Remplacez &quot;nom_du_role&quot; par le nom que vous souhaitez donner à votre rôle. Par exemple, si vous souhaitez créer un rôle appelé &quot;mon_role&quot;, la commande serait :</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ansible-galaxy init mon_role</span></span></code></pre></div></li><li><p>Après l&#39;exécution de la commande, un nouveau répertoire portant le nom du rôle sera créé dans le répertoire actuel. Ce répertoire contiendra la structure de base du rôle Ansible, y compris les répertoires suivants :</p><details class="details custom-block"><summary>Structure de dossier :</summary><ul><li><strong>defaults/</strong> : Ce répertoire contient les variables par défaut pour le rôle.</li><li><strong>files/</strong> : Ce répertoire est utilisé pour stocker les fichiers à copier sur les machines cibles.</li><li><strong>handlers/</strong> : Ce répertoire contient les gestionnaires (handlers) utilisés par les tâches.</li><li><strong>meta/</strong> : Ce répertoire est utilisé pour stocker les métadonnées du rôle.</li><li><strong>tasks/</strong> : Ce répertoire contient les tâches principales du rôle.</li><li><strong>templates/</strong> : Ce répertoire est utilisé pour stocker les templates à utiliser par le rôle.</li><li><strong>tests/</strong> : Ce répertoire est utilisé pour stocker les fichiers de tests pour le rôle.</li><li><strong>vars/</strong> : Ce répertoire contient les fichiers de variables spécifiques au rôle.</li></ul></details></li><li><p>Pour la création des fichiers et tâches spécifiques, suivez les étapes ci-dessous :</p><p>a. Tâche &quot;after symlink&quot; (après la création des liens symboliques) : Créez un fichier YAML dans le répertoire <code>tasks</code> avec le nom <code>after_symlink.yml</code>. Cette tâche peut contenir les actions à effectuer après la création des liens symboliques.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Exécuter des actions après la création des liens symboliques</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;font-style:italic;"># Ajoutez ici les actions spécifiques</span></span></code></pre></div><p>b. Tâche &quot;before symlink&quot; (avant la création des liens symboliques) : Créez un fichier YAML dans le répertoire <code>tasks</code> avec le nom <code>before_symlink.yml</code>. Cette tâche peut contenir les actions à effectuer avant la création des liens symboliques.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Exécuter des actions avant la création des liens symboliques</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># Ajoutez ici les actions spécifiques</span></span></code></pre></div><p>c. Tâche &quot;main&quot; (tâches principales) : Créez un fichier YAML dans le répertoire <code>tasks</code> avec le nom <code>main.yml</code>. Cette tâche contient les actions principales du rôle.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># tasks file for Lagon_ansistrano</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">correct unsafe git repo error</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">shell</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git config --global --add safe.directory {{ ************}}/repo</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">include_role</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ansistrano.deploy</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># name: ansistrano.rollback</span></span></code></pre></div><p>d. Templates : Créez les templates requis dans le répertoire <code>templates</code>. Pour les fichiers <code>docker-compose.yml</code>, <code>Dockerfile</code> et <code>Vhost</code>, créez les fichiers suivants :</p><pre><code> - \`docker-compose.yml.j2\`
 - \`Dockerfile.j2\`
 - \`Vhost.j2\`
</code></pre><p>e. Fichier &quot;db_vars&quot; : Créez un fichier YAML dans le répertoire <code>vars</code> avec le nom <code>db_vars.yml</code>. Ce fichier peut contenir les variables spécifiques à la base de données.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">db_host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">localhost</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">db_user</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myuser</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">db_password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mypassword</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">db_name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mydatabase</span></span></code></pre></div><p>f. Fichier &quot;main&quot; : Le fichier <code>main.yml</code> dans le répertoire <code>vars</code> contient les variable nécéssaire aux déploiement du projet .</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># vars file for Assurmix_inte</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dest</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{ ****** }}/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_deploy_via</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_git_branch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_git_repo</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://{{ *********** }}@github.com/*******/*********.git</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_deploy_to</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{ dest }}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_before_symlink_shared_tasks_file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tasks/before_symlink.yml</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_after_symlink_tasks_file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tasks/after_symlink.yml</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ansistrano_keep_releases</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span></code></pre></div></li><li><p>Une fois que vous avez personnalisé les fichiers, les tâches et les templates selon vos besoins spécifiques, vous pouvez les utiliser dans vos playbooks Ansible.</p></li></ol><p>Assurez-vous d&#39;adapter les noms des fichiers, des tâches et des variables en fonction de votre structure et de vos besoins réels.</p>`,4),t=[o];function p(r,i,c,y,d,u){return e(),a("div",null,t)}const m=s(l,[["render",p]]);export{D as __pageData,m as default};
